// Variables
$default-border: 1px solid var(--color-border-dark);
$default-bg: rgba(0, 0, 0, 0.5);
$control-size: 24px;
$portrait-hover-border: var(--color-border-highlight);

// Mixins
@mixin center-flex {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin control-button-base {
  width: $control-size;
  height: $control-size;
  padding: 0;
  color: var(--color-text-light-highlight);
  background: $default-bg;
  cursor: pointer;
  @include center-flex;
  line-height: 1;

  i.fas {
    @include center-flex;
    width: 100%;
    height: 100%;
    line-height: 0;
    margin: 0;
    padding: 0;
  }
}

@mixin portrait-container-base {
  display: grid;
  background: $default-bg;
  border: $default-border;
}

// Common portrait styles
.portrait-container {
  @include portrait-container-base;

  .portrait {
    border: $default-border;
    overflow: hidden;

    &.flash {
      animation: portrait-flash 0.5s ease-out;
    }

    @keyframes portrait-flash {
      0% { border-color: white; }
      100% { border-color: var(--color-border-dark); }
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }
}

// V13 CSS Layers compatibility - Simplified
@layer foundry.interface {
  
  // Embedded HUD styles for V13
  #ui-right-column-1 #chat,
  section.chat-sidebar.directory.flexcol {
    #emotive-hud-container {
      flex: 0 0 auto;
      min-height: 0;
      width: 100%;
      line-height: 0;
      font-size: 0;
      position: relative;
      margin-bottom: 10px;
      z-index: 10;
    }

    .emotive-hud {
      display: flex;
      flex-direction: column;
      font-size: var(--font-size-14);
      line-height: 1;
      position: relative;

      .portrait-container {
        gap: 1px;
        grid-template-columns: repeat(var(--grid-columns), 1fr);
        width: 100%;

        .portrait {
          aspect-ratio: var(--portrait-ratio);
        }
      }

      .hud-controls {
        position: absolute;
        left: -($control-size + 8px); // Position to the left of the container
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 2px;
        background: $default-bg;
        border: $default-border;
        border-radius: 3px;
        padding: 2px;
        z-index: 15;

        .control-button {
          @include control-button-base;
          border: none;
          background: none;
          
          i {
            font-size: 8px;
          }

          &:hover {
            color: white;
          }
        }
      }
    }
  }
}

// Floating HUD styles
div#emotive-hud.floating {
  position: fixed;
  z-index: 45;
  pointer-events: none;
  transition: right 0.1s ease;

  .emotive-hud {
    position: relative;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 8px;

    .hud-controls {
      pointer-events: all;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-self: flex-start;

      .control-button {
        @include control-button-base;
        border-radius: 3px;

        &:hover {
          border-color: $portrait-hover-border;
        }

        i {
          font-size: 12px;
        }
      }
    }

    .portrait-container {
      pointer-events: all;
      gap: 8px;
      padding: 16px;
      border-radius: 3px;
      grid-template-columns: repeat(min(var(--portrait-count), var(--grid-columns)), var(--floatingPortraitWidth));
      width: fit-content;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);

      .portrait {
        aspect-ratio: var(--portrait-ratio);
        width: var(--floatingPortraitWidth);

        &:hover {
          border-color: $portrait-hover-border;
        }
      }
    }
  }
}

// Performance optimizations for reduced motion
@media (prefers-reduced-motion: reduce) {
  .portrait-container .portrait {
    &.flash {
      animation: none;
      border-color: white !important;
    }
  }
  
  div#emotive-hud.floating {
    transition: none !important;
  }
}